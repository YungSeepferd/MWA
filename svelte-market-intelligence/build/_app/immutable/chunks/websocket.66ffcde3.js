var r=Object.defineProperty;var d=(a,t,e)=>t in a?r(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var o=(a,t,e)=>(d(a,typeof t!="symbol"?t+"":t,e),e);import{w as s}from"./api.f5325af4.js";import{w as n}from"./index.25c19884.js";class p{constructor(){o(this,"isConnected",n(!1));o(this,"messages",n([]));o(this,"contactUpdates",n([]));o(this,"systemStatus",n({crawler:{status:"stopped",lastRun:"",nextRun:""},database:{status:"healthy",size:0,connections:0},notifications:{status:"active",sentToday:0},uptime:"",timestamp:""}));o(this,"dashboardStats",n({total_contacts:0,approved_contacts:0,pending_contacts:0,rejected_contacts:0,average_confidence_score:0,average_quality_score:0,outreach_success_rate:0,contacts_by_status:{},top_sources:[],monthly_trends:[],timestamp:""}));o(this,"scraperStatus",n({status:"stopped",active_jobs:0,completed_jobs:0,failed_jobs:0,timestamp:""}));o(this,"systemMetrics",n({cpu_usage:0,memory_usage:0,disk_usage:0,active_connections:0,request_rate:0,error_rate:0,timestamp:""}));o(this,"contactDiscoveryUpdates",n([]));o(this,"searchStatusUpdates",n([]));o(this,"jobProgressUpdates",n([]));this.initialize()}async initialize(){try{await s.connect(),this.setupEventListeners(),this.isConnected.set(!0),console.log("WebSocket connected successfully")}catch(t){console.error("WebSocket connection failed:",t),this.isConnected.set(!1)}}setupEventListeners(){s.on("contact_created",this.handleContactCreated.bind(this)),s.on("contact_updated",this.handleContactUpdated.bind(this)),s.on("contact_deleted",this.handleContactDeleted.bind(this)),s.on("contact_approved",this.handleContactApproved.bind(this)),s.on("contact_rejected",this.handleContactRejected.bind(this)),s.on("analytics_updated",this.handleAnalyticsUpdated.bind(this)),s.on("system_notification",this.handleSystemNotification.bind(this)),s.on("system_status",this.handleSystemStatus.bind(this)),s.on("dashboard_update",this.handleDashboardUpdate.bind(this)),s.on("scraper_update",this.handleScraperUpdate.bind(this)),s.on("contact_discovery",this.handleContactDiscovery.bind(this)),s.on("search_status",this.handleSearchStatus.bind(this)),s.on("job_progress",this.handleJobProgress.bind(this)),s.on("system_metrics",this.handleSystemMetrics.bind(this))}handleContactCreated(t){console.log("Contact created:",t),this.addMessage({type:"contact_created",data:t,timestamp:new Date().toISOString()}),this.contactUpdates.update(e=>[{type:"contact_created",data:t,timestamp:new Date().toISOString()},...e.slice(0,9)])}handleContactUpdated(t){console.log("Contact updated:",t),this.addMessage({type:"contact_updated",data:t,timestamp:new Date().toISOString()}),this.contactUpdates.update(e=>[{type:"contact_updated",data:t,timestamp:new Date().toISOString()},...e.slice(0,9)])}handleContactDeleted(t){console.log("Contact deleted:",t),this.addMessage({type:"contact_deleted",data:t,timestamp:new Date().toISOString()}),this.contactUpdates.update(e=>[{type:"contact_deleted",data:t,timestamp:new Date().toISOString()},...e.slice(0,9)])}handleContactApproved(t){console.log("Contact approved:",t),this.addMessage({type:"contact_approved",data:t,timestamp:new Date().toISOString()}),this.contactUpdates.update(e=>[{type:"contact_approved",data:t,timestamp:new Date().toISOString()},...e.slice(0,9)])}handleContactRejected(t){console.log("Contact rejected:",t),this.addMessage({type:"contact_rejected",data:t,timestamp:new Date().toISOString()}),this.contactUpdates.update(e=>[{type:"contact_rejected",data:t,timestamp:new Date().toISOString()},...e.slice(0,9)])}handleAnalyticsUpdated(t){console.log("Analytics updated:",t),this.addMessage({type:"analytics_updated",data:t,timestamp:new Date().toISOString()}),window.dispatchEvent(new CustomEvent("analytics-update",{detail:t}))}handleSystemNotification(t){console.log("System notification:",t),this.addMessage({type:"system_notification",data:t,timestamp:new Date().toISOString()}),Notification.permission==="granted"&&new Notification(t.title||"System Notification",{body:t.message,icon:"/favicon.ico"})}handleSystemStatus(t){console.log("System status updated:",t),this.systemStatus.set({...t,timestamp:new Date().toISOString()})}handleDashboardUpdate(t){console.log("Dashboard update received:",t),this.dashboardStats.set({...t,timestamp:new Date().toISOString()}),window.dispatchEvent(new CustomEvent("dashboard-update",{detail:t}))}handleScraperUpdate(t){console.log("Scraper update received:",t),this.scraperStatus.set({...t,timestamp:new Date().toISOString()}),(t.status==="running"||t.status==="error")&&this.showNotification(`Scraper status: ${t.status}`,t.status==="error"?"error":"info")}handleContactDiscovery(t){console.log("Contact discovery update:",t);const e={new_contacts:t.new_contacts||0,source:t.source||"unknown",confidence:t.confidence||"medium",timestamp:new Date().toISOString()};this.contactDiscoveryUpdates.update(c=>[e,...c.slice(0,9)]),this.showNotification(`New ${e.new_contacts} contacts discovered from ${e.source}`,"info")}handleSearchStatus(t){console.log("Search status update:",t);const e={search_id:t.search_id,status:t.status||"running",results_count:t.results_count||0,progress:t.progress||0,estimated_completion:t.estimated_completion,timestamp:new Date().toISOString()};this.searchStatusUpdates.update(c=>[e,...c.slice(0,9)]),e.status==="completed"&&this.showNotification(`Search completed: ${e.results_count} results`,"success")}handleJobProgress(t){console.log("Job progress update:",t);const e={job_id:t.job_id,job_type:t.job_type,status:t.status,progress:t.progress||0,current_step:t.current_step||0,total_steps:t.total_steps||1,estimated_completion:t.estimated_completion,results:t.results,error:t.error,timestamp:new Date().toISOString()};this.jobProgressUpdates.update(c=>[e,...c.slice(0,9)]),e.status==="completed"?this.showNotification(`Job ${e.job_id} completed`,"success"):e.status==="error"&&this.showNotification(`Job ${e.job_id} failed: ${e.error}`,"error")}handleSystemMetrics(t){console.log("System metrics update:",t),this.systemMetrics.set({...t,timestamp:new Date().toISOString()}),window.dispatchEvent(new CustomEvent("system-metrics-update",{detail:t}))}showNotification(t,e="info"){window.dispatchEvent(new CustomEvent("system-notification",{detail:{message:t,type:e,timestamp:new Date().toISOString()}})),Notification.permission==="granted"&&new Notification("MWA System Notification",{body:t,icon:"/favicon.ico"})}addMessage(t){this.messages.update(e=>[t,...e])}subscribe(t){return this.isConnected.subscribe(t)}subscribeMessages(t){return this.messages.subscribe(t)}subscribeContactUpdates(t){return this.contactUpdates.subscribe(t)}subscribeSystemStatus(t){return this.systemStatus.subscribe(t)}subscribeDashboardStats(t){return this.dashboardStats.subscribe(t)}subscribeScraperStatus(t){return this.scraperStatus.subscribe(t)}subscribeSystemMetrics(t){return this.systemMetrics.subscribe(t)}subscribeContactDiscoveryUpdates(t){return this.contactDiscoveryUpdates.subscribe(t)}subscribeSearchStatusUpdates(t){return this.searchStatusUpdates.subscribe(t)}subscribeJobProgressUpdates(t){return this.jobProgressUpdates.subscribe(t)}getConnectionStatus(){let t=!1;return this.isConnected.subscribe(e=>{t=e})(),t}async reconnect(){try{return await s.connect(),this.isConnected.set(!0),!0}catch(t){return console.error("Reconnection failed:",t),this.isConnected.set(!1),!1}}disconnect(){s.disconnect(),this.isConnected.set(!1)}sendMessage(t,e){this.getConnectionStatus()?s.send({type:t,data:e,timestamp:new Date().toISOString()}):console.warn("Cannot send message: WebSocket not connected")}refreshAnalytics(){this.sendMessage("refresh_analytics",{})}refreshContacts(){this.sendMessage("refresh_contacts",{})}clearMessages(){this.messages.set([])}clearContactUpdates(){this.contactUpdates.set([])}}const i=new p;i.isConnected;i.messages;const m=i.contactUpdates,S=i.systemStatus;i.dashboardStats;i.scraperStatus;i.systemMetrics;i.contactDiscoveryUpdates;i.searchStatusUpdates;i.jobProgressUpdates;export{m as c,i as r,S as s};
